<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Fit Ultimate Deconvolution Model — ud_fit • udr</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Fit Ultimate Deconvolution Model — ud_fit"><meta property="og:description" content="This function implements
empirical Bayes methods for fitting a multivariate version of the normal means
model with flexible prior. These methods are closely related to approaches for
multivariate density deconvolution (Sarkar et al, 2018), so
it can also be viewed as a method for multivariate density
deconvolution."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">udr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.3-152</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/stephenslab/udr" class="external-link">Source</a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Fit Ultimate Deconvolution Model</h1>
    <small class="dont-index">Source: <a href="https://github.com/stephenslab/udr/blob/HEAD/R/ud_fit.R" class="external-link"><code>R/ud_fit.R</code></a></small>
    <div class="hidden name"><code>ud_fit.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function implements
empirical Bayes methods for fitting a multivariate version of the normal means
model with flexible prior. These methods are closely related to approaches for
multivariate density deconvolution (Sarkar <em>et al</em>, 2018), so
it can also be viewed as a method for multivariate density
deconvolution.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">ud_fit</span><span class="op">(</span><span class="va">fit</span>, <span class="va">X</span>, control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="fu">ud_fit_control_default</span><span class="op">(</span><span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>fit</dt>
<dd><p>A previous Ultimate Deconvolution model fit. Typically,
this will be an output of <code><a href="ud_init.html">ud_init</a></code> or an output
from a previous call to <code>ud_fit</code>.</p></dd>


<dt>X</dt>
<dd><p>Optional n x m data matrix, in which each row of the matrix is
an m-dimensional data point. The number of rows and columns should
be 2 or more. When not provided, <code>fit$X</code> is used.</p></dd>


<dt>control</dt>
<dd><p>A list of parameters controlling the behaviour of
the model fitting and initialization. See ‘Details’.</p></dd>


<dt>verbose</dt>
<dd><p>When <code>verbose = TRUE</code>, information about the
algorithm's progress is printed to the console at each
iteration. For interpretation of the columns, see the description
of the <code>progress</code> return value.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>An Ultimate Deconvolution model fit. It is a list object
with the following elements:</p>
<dl><dt>X</dt>
<dd><p>The data matrix used to fix the model.</p></dd>


<dt>w</dt>
<dd><p>A vector containing the estimated mixture weights \(w\)</p></dd>


<dt>U</dt>
<dd><p>A list containing the estimated prior covariance matrices \(U\)</p></dd>


<dt>V</dt>
<dd><p>The residual covariance matrix \(V\), or a list of
  \(V_j\) used in the model fit.</p></dd>


<dt>P</dt>
<dd><p>The responsibilities matrix in which <code>P[i,j]</code> is the
  posterior mixture probability for data point i and mixture
  component j.</p></dd>


<dt>loglik</dt>
<dd><p>The log-likelihood at the current settings of the
  model parameters.</p></dd>


<dt>progress</dt>
<dd><p>A data frame containing detailed information about
  the algorithm's progress. The columns of the data frame are:
  "iter", the iteration number; "loglik", the log-likelihood at the
  current estimates of the model parameters; "loglik.pen", the penalized
  log-likelihood at the current estimates of the model parameters. It is equal
  to "loglik" when no covariance regularization is used. "delta.w", the largest
  change in the mixture weights; "delta.u", the largest change in the
  prior covariance matrices; "delta.v", the largest change in the
  residual covariance matrix; and "timing", the elapsed time in
  seconds (recorded using <code><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></code>).</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>The udr package fits the following
Empirical Bayes version of the multivariate normal means model:</p>
<p>Independently for \(j=1,\dots,n\),</p>
<p>\(x_j | \theta_j, V_j ~ N_m(\theta_j, V_j)\);</p>
<p>\(\theta_j | V_j ~ w_1 N_m(0, U_1) + \dots + w_K N_m(0,U_K)\).</p>
<p>Here the variances \(V_j\) are usually considered known, and may be equal (\(V_j=V\))
which can greatly simplify computation. The prior on \(theta_j\) is a mixture of \(K \ge 2\) multivariate normals, with
unknown mixture proportions \(w=(w_1,...,w_K)\) and covariance matrices \(U=(U_1,...,U_K)\).
We call this the ``Ultimate Deconvolution" (UD) model.</p>
<p>Fitting the UD model involves
i) obtaining maximum likelihood estimates \(\hat{w}\) and \(\hat{U}\) for
the prior parameters \(w\) and \(U\); ii) computing the posterior distributions
\(p(\theta_j | x_j, \hat{w}, \hat{U})\).</p>
<p>The UD model is fit by an iterative expectation-maximization (EM)-based
algorithm. Various algorithms are implemented to deal with different constraints
on each \(U_k\). Specifically, each \(U_k\) can be i) constrained to be a scalar multiple of a
pre-specified matrix; or ii) constrained to be a rank-1 matrix; or iii)
unconstrained. How many mixture components to use and which constraints to apply
to each \(U_k\) are specified using <a href="ud_init.html">ud_init</a>.</p>
<p>In addition, we introduced two covariance regularization approaches to handle the high dimensional
challenges, where sample size is relatively small compared with data dimension. 
One is called nucler norm regularization, short for "nu". 
The other is called inverse-Wishart regularization, short for "iw".</p>

<p>The <code>control</code> argument can be used to adjust the algorithm
settings, although the default settings should suffice for most users.
It is a list in which any of the following named components
will override the default algorithm settings (as they are defined
by <code>ud_fit_control_default</code>):</p>
<dl><dt><code>weights.update</code></dt>
<dd><p>When <code>weights.update = "em"</code>, the
mixture weights are updated via EM; when <code>weights.update =
"none"</code>, the mixture weights are not updated.</p></dd>


<dt><code>resid.update</code></dt>
<dd><p>When <code>resid.update = "em"</code>, the
residual covariance matrix \(V\) is updated via an EM step; this
option is experimental, not tested and not recommended. When
<code>resid.update = "none"</code>, the residual covariance matrices
\(V\) is not updated.</p></dd>


<dt><code>scaled.update</code></dt>
<dd><p>This setting specifies the updates for
the scaled prior covariance matrices. Possible settings are
<code>"fa"</code>, <code>"none"</code> or <code>NA</code>.</p></dd>


<dt><code>rank1.update</code></dt>
<dd><p>This setting specifies the updates for
the rank-1 prior covariance matrices. Possible settings are
<code>"ed"</code>, <code>"ted"</code>, <code>"none"</code> or <code>NA</code>.</p></dd>


<dt><code>unconstrained.update</code></dt>
<dd><p>This setting determines the
updates used to estimate the unconstrained prior covariance
matrices. Two variants of EM are implemented: <code>update.U =
"ed"</code>, the EM updates described by Bovy <em>et al</em> (2011); and
<code>update.U = "ted"</code>, "truncated eigenvalue decomposition", in
which the M-step update for each covariance matrix <code>U[[j]]</code> is
solved by truncating the eigenvalues in a spectral decomposition of
the unconstrained maximimum likelihood estimate (MLE) of
<code>U[[j]]</code>. Other possible settings include <code>"none"</code> or
codeNA.</p></dd>


<dt><code>version</code></dt>
<dd><p>R and C++ implementations of the model
fitting algorithm are provided; these are selected with
<code>version = "R"</code> and <code>version = "Rcpp"</code>.</p></dd>


<dt><code>maxiter</code></dt>
<dd><p>The upper limit on the number of updates
to perform.</p></dd>


<dt><code>tol</code></dt>
<dd><p>The updates are halted when the largest change in
the model parameters between two successive updates is less than
<code>tol</code>.</p></dd>


<dt><code>tol.lik</code></dt>
<dd><p>The updates are halted when the change in
increase in the likelihood between two successive iterations is
less than <code>tol.lik</code>.</p></dd>


<dt><code>minval</code></dt>
<dd><p>Minimum eigenvalue allowed in the residual
covariance(s) <code>V</code> and the prior covariance matrices
<code>U</code>. Should be a small, positive number.</p></dd>


<dt><code>update.threshold</code></dt>
<dd><p>A prior covariance matrix
<code>U[[i]]</code> is only updated if the total “responsibility”
for component <code>i</code> exceeds <code>update.threshold</code>; that is,
only if <code>sum(P[,i]) &gt; update.threshold</code>.</p></dd>


<dt><code>lambda</code></dt>
<dd><p>Parameter to control the strength of covariance
regularization. <code>lambda = 0</code> indicates no covariance regularization.</p></dd>


<dt><code>penalty.type</code></dt>
<dd><p>Specifies the type of covariance regularization to use.
"iw": inverse Wishart regularization, "nu": nuclear norm regularization.</p></dd>

</dl><p>Using this function requires some care; currently only minimal
argument checking is performed. See the documentation and examples
for guidance.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>J. Bovy, D. W. Hogg and S. T. Roweis (2011). Extreme Deconvolution:
inferring complete distribution functions from noisy, heterogeneous
and incomplete observations. <em>Annals of Applied Statistics</em>,
<b>5</b>, 1657???1677. doi:10.1214/10-AOAS439</p>
<p>D. B. Rubin and D. T. Thayer (1982). EM algorithms for ML factor
analysis. Psychometrika <b>47</b>, 69-76. doi:10.1007/BF02293851</p>
<p>A. Sarkar, D. Pati, A. Chakraborty, B. K. Mallick and R. J. Carroll
(2018). Bayesian semiparametric multivariate density deconvolution.
<em>Journal of the American Statistical Association</em> <b>113</b>,
401???416. doi:10.1080/01621459.2016.1260467</p>
<p>J. Won, J. Lim, S. Kim and B. Rajaratnam (2013).
Condition-number-regularized covariance estimation. <em>Journal
of the Royal Statistical Society, Series B</em> <b>75</b>,
427???450. doi:10.1111/j.1467-9868.2012.01049.x</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="co"># Simulate data from a UD model.</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span class="r-in"><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">4000</span></span>
<span class="r-in"><span class="va">V</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.8</span>,<span class="fl">0.2</span><span class="op">)</span>,</span>
<span class="r-in">           <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>,<span class="fl">1.5</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="va">U</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>none   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,</span>
<span class="r-in">                         <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span>,</span>
<span class="r-in">          shared <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.0</span>,<span class="fl">0.9</span><span class="op">)</span>,</span>
<span class="r-in">                         <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.9</span>,<span class="fl">1.0</span><span class="op">)</span><span class="op">)</span>,</span>
<span class="r-in">          only1  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span>,</span>
<span class="r-in">                         <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span>,</span>
<span class="r-in">          only2  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,</span>
<span class="r-in">                         <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.8</span>,<span class="fl">0.1</span>,<span class="fl">0.075</span>,<span class="fl">0.025</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">V</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"d1"</span>,<span class="st">"d2"</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">V</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"d1"</span>,<span class="st">"d2"</span><span class="op">)</span></span>
<span class="r-in"><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="simulate_ud_data.html">simulate_ud_data</a></span><span class="op">(</span><span class="va">n</span>,<span class="va">w</span>,<span class="va">U</span>,<span class="va">V</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># This is the simplest invocation of ud_init and ud_fit.</span></span>
<span class="r-in"><span class="co"># It uses the default settings for the prior</span></span>
<span class="r-in"><span class="co"># (which are 2 scaled components, 4 rank-1 components, and 4 unconstrained components)</span></span>
<span class="r-in"><span class="va">fit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="ud_init.html">ud_init</a></span><span class="op">(</span><span class="va">X</span>,V <span class="op">=</span> <span class="va">V</span><span class="op">)</span></span>
<span class="r-in"><span class="va">fit1</span> <span class="op">&lt;-</span> <span class="fu">ud_fit</span><span class="op">(</span><span class="va">fit1</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Performing Ultimate Deconvolution on 4000 x 2 matrix (udr 0.3-152, "R"):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> data points are i.i.d. (same V)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> prior covariances: 2 scaled, 0 rank-1, 8 unconstrained</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> prior covariance updates: scaled (fa), rank-1 (none), unconstrained (ted)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> covariance regularization: penalty strength = 0.00e+00, method = iw</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> mixture weights update: em</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> residual covariance update: none</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> max 20 updates, tol=1.0e-06, tol.lik=1.0e-03</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iter          log-likelihood    log-likelihood.pen   |w - w'| |U - U'| |V - V'|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    1 -1.2279804719045842e+04 -1.2279804719045842e+04 4.68e-02 1.28e+01 0.00e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    2 -1.2223122563101466e+04 -1.2223122563101466e+04 8.81e-03 5.10e-01 0.00e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    3 -1.2212191560680643e+04 -1.2212191560680643e+04 6.38e-03 1.89e-01 0.00e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    4 -1.2208916818919344e+04 -1.2208916818919344e+04 4.86e-03 8.34e-02 0.00e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    5 -1.2207216863575988e+04 -1.2207216863575988e+04 4.05e-03 4.79e-02 0.00e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    6 -1.2206156766378293e+04 -1.2206156766378293e+04 3.50e-03 3.68e-02 0.00e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    7 -1.2205421131712248e+04 -1.2205421131712248e+04 3.08e-03 3.03e-02 0.00e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    8 -1.2204896399982579e+04 -1.2204896399982579e+04 2.74e-03 2.46e-02 0.00e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    9 -1.2204481866400763e+04 -1.2204481866400763e+04 2.48e-03 1.95e-02 0.00e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   10 -1.2204146935386652e+04 -1.2204146935386652e+04 2.26e-03 1.51e-02 0.00e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   11 -1.2203870133940494e+04 -1.2203870133940494e+04 2.07e-03 1.14e-02 0.00e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   12 -1.2203634530812882e+04 -1.2203634530812882e+04 1.91e-03 8.30e-03 0.00e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   13 -1.2203423288928794e+04 -1.2203423288928794e+04 1.78e-03 5.97e-03 0.00e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   14 -1.2203229520596969e+04 -1.2203229520596969e+04 1.67e-03 4.45e-03 0.00e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   15 -1.2203050854108164e+04 -1.2203050854108164e+04 1.59e-03 3.40e-03 0.00e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   16 -1.2202885740594420e+04 -1.2202885740594420e+04 1.51e-03 2.64e-03 0.00e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   17 -1.2202732915230425e+04 -1.2202732915230425e+04 1.43e-03 2.23e-03 0.00e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   18 -1.2202591285909395e+04 -1.2202591285909395e+04 1.37e-03 2.09e-03 0.00e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   19 -1.2202459890830853e+04 -1.2202459890830853e+04 1.30e-03 1.98e-03 0.00e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   20 -1.2202337873657989e+04 -1.2202337873657989e+04 1.24e-03 1.89e-03 0.00e+00</span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/stats/logLik.html" class="external-link">logLik</a></span><span class="op">(</span><span class="va">fit1</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 'log Lik.' -12202 (df=NA)</span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit1</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Model overview:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Number of data points: 4000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Dimension of data points: 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Data points are i.i.d. (same V)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Number of scaled prior covariances: 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Number of rank-1 prior covariances: 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Number of unconstrained prior covariances: 8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Evaluation of fit (20 updates performed):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Log-likelihood: -1.220233787366e+04</span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit1</span><span class="op">$</span><span class="va">progress</span><span class="op">$</span><span class="va">iter</span>,</span>
<span class="r-in">     <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">fit1</span><span class="op">$</span><span class="va">progress</span><span class="op">$</span><span class="va">loglik</span><span class="op">)</span> <span class="op">-</span> <span class="va">fit1</span><span class="op">$</span><span class="va">progress</span><span class="op">$</span><span class="va">loglik</span> <span class="op">+</span> <span class="fl">0.1</span>,</span>
<span class="r-in">     type <span class="op">=</span> <span class="st">"l"</span>,col <span class="op">=</span> <span class="st">"dodgerblue"</span>,lwd <span class="op">=</span> <span class="fl">2</span>,log <span class="op">=</span> <span class="st">"y"</span>,xlab <span class="op">=</span> <span class="st">"iteration"</span>,</span>
<span class="r-in">     ylab <span class="op">=</span> <span class="st">"dist to best loglik"</span><span class="op">)</span></span>
<span class="r-plt img"><img src="ud_fit-1.png" alt="" width="700" height="433"></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># This is a more complex invocation of ud_init that overrides some</span></span>
<span class="r-in"><span class="co"># of the defaults.</span></span>
<span class="r-in"><span class="va">fit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="ud_init.html">ud_init</a></span><span class="op">(</span><span class="va">X</span>,U_scaled <span class="op">=</span> <span class="va">U</span>,n_rank1 <span class="op">=</span> <span class="fl">1</span>,n_unconstrained <span class="op">=</span> <span class="fl">1</span>,V <span class="op">=</span> <span class="va">V</span><span class="op">)</span></span>
<span class="r-in"><span class="va">fit2</span> <span class="op">&lt;-</span> <span class="fu">ud_fit</span><span class="op">(</span><span class="va">fit2</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Performing Ultimate Deconvolution on 4000 x 2 matrix (udr 0.3-152, "R"):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> data points are i.i.d. (same V)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> prior covariances: 4 scaled, 1 rank-1, 1 unconstrained</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> prior covariance updates: scaled (fa), rank-1 (ted), unconstrained (ted)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> covariance regularization: penalty strength = 0.00e+00, method = iw</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> mixture weights update: em</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> residual covariance update: none</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> max 20 updates, tol=1.0e-06, tol.lik=1.0e-03</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iter          log-likelihood    log-likelihood.pen   |w - w'| |U - U'| |V - V'|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    1 -1.2254274362886588e+04 -1.2254274362886588e+04 2.15e-02 1.01e+00 0.00e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    2 -1.2234214947140643e+04 -1.2234214947140643e+04 7.12e-03 2.99e-01 0.00e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    3 -1.2224394571154378e+04 -1.2224394571154378e+04 5.32e-03 1.62e-01 0.00e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    4 -1.2219820969163555e+04 -1.2219820969163555e+04 4.73e-03 1.00e-01 0.00e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    5 -1.2216889114009215e+04 -1.2216889114009215e+04 4.15e-03 6.61e-02 0.00e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    6 -1.2214904923248048e+04 -1.2214904923248048e+04 3.61e-03 4.32e-02 0.00e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    7 -1.2213781656525432e+04 -1.2213781656525432e+04 3.12e-03 4.90e-03 0.00e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    8 -1.2212842079106016e+04 -1.2212842079106016e+04 2.83e-03 6.62e-24 0.00e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    9 -1.2211992244201772e+04 -1.2211992244201772e+04 2.66e-03 3.31e-24 0.00e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   10 -1.2211222160441317e+04 -1.2211222160441317e+04 2.53e-03 6.62e-24 0.00e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   11 -1.2210522990596364e+04 -1.2210522990596364e+04 2.41e-03 6.62e-24 0.00e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   12 -1.2209886923773960e+04 -1.2209886923773960e+04 2.30e-03 9.93e-24 0.00e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   13 -1.2209307059316559e+04 -1.2209307059316559e+04 2.19e-03 6.62e-24 0.00e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   14 -1.2208777302107714e+04 -1.2208777302107714e+04 2.09e-03 3.31e-24 0.00e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   15 -1.2208292268716075e+04 -1.2208292268716075e+04 2.07e-03 3.31e-24 0.00e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   16 -1.2207847203652633e+04 -1.2207847203652633e+04 2.06e-03 9.93e-24 0.00e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   17 -1.2207437904935397e+04 -1.2207437904935397e+04 2.04e-03 9.93e-24 0.00e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   18 -1.2207060658129330e+04 -1.2207060658129330e+04 2.02e-03 6.62e-24 0.00e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   19 -1.2206712178039492e+04 -1.2206712178039492e+04 2.00e-03 6.62e-24 0.00e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   20 -1.2206389557269531e+04 -1.2206389557269531e+04 1.97e-03 6.62e-24 0.00e+00</span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/stats/logLik.html" class="external-link">logLik</a></span><span class="op">(</span><span class="va">fit2</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 'log Lik.' -12206 (df=NA)</span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit2</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Model overview:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Number of data points: 4000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Dimension of data points: 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Data points are i.i.d. (same V)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Number of scaled prior covariances: 4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Number of rank-1 prior covariances: 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Number of unconstrained prior covariances: 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Evaluation of fit (20 updates performed):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Log-likelihood: -1.220638955727e+04</span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit2</span><span class="op">$</span><span class="va">progress</span><span class="op">$</span><span class="va">iter</span>,</span>
<span class="r-in">     <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">fit2</span><span class="op">$</span><span class="va">progress</span><span class="op">$</span><span class="va">loglik</span><span class="op">)</span> <span class="op">-</span> <span class="va">fit2</span><span class="op">$</span><span class="va">progress</span><span class="op">$</span><span class="va">loglik</span> <span class="op">+</span> <span class="fl">0.1</span>,</span>
<span class="r-in">     type <span class="op">=</span> <span class="st">"l"</span>,col <span class="op">=</span> <span class="st">"dodgerblue"</span>,lwd <span class="op">=</span> <span class="fl">2</span>,log <span class="op">=</span> <span class="st">"y"</span>,xlab <span class="op">=</span> <span class="st">"iteration"</span>,</span>
<span class="r-in">     ylab <span class="op">=</span> <span class="st">"dist to best loglik"</span><span class="op">)</span></span>
<span class="r-plt img"><img src="ud_fit-2.png" alt="" width="700" height="433"></span>
<span class="r-in"></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Peter Carbonetto, Yunqi Yang, Matthew Stephens.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

